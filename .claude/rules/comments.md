# Политика комментариев

## Основной принцип

> **Код должен быть самодокументируемым.**
> Если нужен комментарий, чтобы объяснить ЧТО делает код — рассмотри рефакторинг.
> Комментарии нужны, чтобы объяснить ПОЧЕМУ.

---

## Языки комментариев

| Контекст | Язык |
|----------|------|
| Код 1С (.bsl) | Русский |
| Документация проекта (.md) | Русский |
| API документация | English |
| Конфигурационные файлы | English |

---

## Допустимые комментарии

### 1. Бизнес-правила

```bsl
// Бизнес-правило: заказы старше 30 дней не могут быть отменены
Если ДнейСоздания > 30 Тогда
    Возврат НовыйРезультатОтмены(Ложь, "Превышен срок отмены");
КонецЕсли;
```

### 2. Обходные решения (workarounds)

```bsl
// Workaround для ошибки платформы #12345 - удалить после обновления до 8.3.28
// https://bugtracker.1c.ru/12345
Если ВерсияПлатформы < "8.3.28" Тогда
    // Временное решение
КонецЕсли;
```

### 3. Предупреждения о контексте

```bsl
// ВНИМАНИЕ: Этот метод вызывается из фонового задания, сессия пользователя недоступна
Процедура ОбработатьОчередь() Экспорт
    // ...
КонецПроцедуры
```

### 4. Сложные алгоритмы

```bsl
// Алгоритм распределения скидки по строкам:
// 1. Сортировка по убыванию суммы
// 2. Распределение пропорционально сумме
// 3. Остаток на последнюю строку (для точности копеек)
Функция РаспределитьСкидку(Строки, СуммаСкидки)
    // ...
КонецФункции
```

### 5. TODO с контекстом

```bsl
// TODO: TASK-123 Добавить кеширование после оптимизации запроса
// Текущая реализация достаточна для объёма < 1000 записей
```

---

## Недопустимые комментарии

### 1. Очевидное из кода

```bsl
// НЕПРАВИЛЬНО
// Увеличиваем счётчик
Счетчик = Счетчик + 1;

// Получаем пользователя
Пользователь = ПолучитьПользователя(Идентификатор);

// Возвращаем результат
Возврат Результат;
```

### 2. Закомментированный код

```bsl
// НЕПРАВИЛЬНО - использовать git для истории
// Функция СтараяРеализация()
//     // старый код
// КонецФункции
```

### 3. TODO без контекста

```bsl
// НЕПРАВИЛЬНО
// TODO: отрефакторить это
// FIXME: исправить потом
```

### 4. Дублирование имени

```bsl
// НЕПРАВИЛЬНО
// Функция получения данных заказа
Функция ПолучитьДанныеЗаказа()  // Имя уже говорит об этом
```

---

## Документирование процедур и функций

### Когда обязательно

1. Все процедуры `Экспорт` (публичный API)
2. Сложные внутренние процедуры, если назначение неочевидно

### Формат документации

```bsl
// Получает данные заказа по идентификатору.
// Выполняет поиск заказа в базе и формирует структуру для API.
//
// Параметры:
//   ИдентификаторЗаказа - УникальныйИдентификатор - UUID заказа
//   ВключатьСтроки - Булево - загружать табличную часть (по умолчанию Истина)
//
// Возвращаемое значение:
//   Структура - данные заказа:
//     * Номер - Строка - номер заказа
//     * Дата - Дата - дата заказа
//     * Сумма - Число - итоговая сумма
//   Неопределено - если заказ не найден
//
Функция ПрефиксПолучитьДанныеЗаказа(ИдентификаторЗаказа, ВключатьСтроки = Истина) Экспорт
```

### Упрощённый формат для простых функций

```bsl
// Проверяет, может ли заказ быть отменён.
//
Функция МожноОтменитьЗаказ(Заказ) Экспорт
```

---

## Таблица решений

| Ситуация | Комментарий? | Пример |
|----------|--------------|--------|
| Бизнес-правило | Да | `// Клиенты категории VIP получают приоритет` |
| Workaround | Да | `// Обход ошибки платформы #123` |
| Неочевидный контекст | Да | `// Вызывается из фонового задания` |
| Сложный алгоритм | Да | `// Алгоритм: ...` |
| TODO с задачей | Да | `// TODO: TASK-456 ...` |
| Очевидный код | Нет | `Счетчик = Счетчик + 1` |
| Имя процедуры | Нет | `ПолучитьПользователя()` |
| Закомментированный код | Нет | Использовать git |
| TODO без номера | Нет | Создать задачу |

---

## Правило рефакторинга

Если код требует много комментариев для понимания:

1. **Рассмотреть разбиение** на более мелкие функции с говорящими именами
2. **Переименовать переменные** для ясности
3. **Упростить логику** если возможно

```bsl
// БЫЛО - требует комментарий
// Проверяем, что клиент активен и не заблокирован
Если Клиент.Статус = 1 И НЕ Клиент.Флаг Тогда

// СТАЛО - комментарий не нужен
Если КлиентАктивен(Клиент) И НЕ КлиентЗаблокирован(Клиент) Тогда
```
